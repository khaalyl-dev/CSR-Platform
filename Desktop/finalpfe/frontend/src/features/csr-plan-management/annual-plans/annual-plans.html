<div class="p-8 space-y-8 bg-gray-50 min-h-screen">
  <div class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold tracking-tight text-gray-800">Plan Annuel</h1>
      <p class="text-gray-500 mt-1">Pilotage et validation des plans CSR multi-sites</p>
    </div>
    <button *ngIf="user()?.role === 'site'"
      class="bg-[rgb(30,41,59)] text-white px-5 py-2.5 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
      + Nouveau Plan
    </button>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white/70 backdrop-blur-lg rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition">
      <p class="text-gray-500 text-sm">Total Plans</p>
      <p class="text-3xl font-bold mt-2 text-gray-800">{{ totalPlans() }}</p>
    </div>
    <div class="bg-white/70 backdrop-blur-lg rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition">
      <p class="text-gray-500 text-sm">En attente</p>
      <p class="text-3xl font-bold mt-2 text-yellow-500">{{ submittedPlans() }}</p>
    </div>
    <div class="bg-white/70 backdrop-blur-lg rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition">
      <p class="text-gray-500 text-sm">Approuvés</p>
      <p class="text-3xl font-bold mt-2 text-green-600">{{ approvedPlans() }}</p>
    </div>
  </div>
  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-wrap items-center justify-between gap-4">
    <div class="flex-1 min-w-[200px]">
      <input type="text" placeholder="Rechercher un site..."
        class="w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none transition duration-200"
        (input)="search.set($any($event.target).value)" />
    </div>
    <div class="flex gap-3 flex-wrap">
      <select class="px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 transition duration-200"
        (change)="selectedStatus.set($any($event.target).value)">
        <option value="">Tous statuts</option>
        <option>Draft</option>
        <option>Submitted</option>
        <option>Approved</option>
        <option>Rejected</option>
      </select>
      <select class="px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 transition duration-200"
        (change)="selectedYear.set(+$any($event.target).value)">
        <option value="">Toutes années</option>
        <option>2023</option>
        <option>2024</option>
        <option>2025</option>
      </select>
    </div>
  </div>
  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50 text-gray-600 uppercase text-xs tracking-wider">
        <tr>
          <th class="p-4 text-left">Année</th>
          <th class="p-4 text-left">Objectif</th>
          <th class="p-4 text-center">Budget</th>
          <th class="p-4 text-center">Progression</th>
          <th class="p-4 text-center">KPI</th>
          <th class="p-4 text-center">Statut</th>
          <th class="p-4 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let plan of filteredPlans()" class="border-t hover:bg-gray-50 transition duration-200">
          <td class="p-4 font-semibold text-gray-800">{{ plan.year }}</td>
          <td class="p-4 text-gray-600 max-w-xs truncate">{{ plan.strategicObjectives }}</td>
          <td class="p-4 text-center text-gray-700">{{ plan.budgetConsumed | number }} / {{ plan.budgetTotal | number }}</td>
          <td class="p-4 w-52">
            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
              <div class="h-2 rounded-full transition-all duration-700 ease-out"
                [ngClass]="{
                  'bg-green-500': getBudgetProgress(plan) < 70,
                  'bg-yellow-500': getBudgetProgress(plan) >= 70 && getBudgetProgress(plan) < 90,
                  'bg-red-500': getBudgetProgress(plan) >= 90
                }"
                [style.width.%]="getBudgetProgress(plan)"></div>
            </div>
            <p class="text-xs text-gray-500 mt-1 text-center">{{ getBudgetProgress(plan) }}%</p>
          </td>
          <td class="p-4 text-center">
            <span class="font-medium">{{ plan.kpiAchieved }} / {{ plan.kpiTarget }}</span>
            <p class="text-xs text-gray-400">{{ getKpiProgress(plan) }}%</p>
          </td>
          <td class="p-4 text-center">
            <span class="px-3 py-1 rounded-full text-xs font-semibold"
              [ngClass]="{
                'bg-gray-200 text-gray-700': plan.status === 'Draft',
                'bg-yellow-100 text-yellow-700': plan.status === 'Submitted',
                'bg-green-100 text-green-700': plan.status === 'Approved',
                'bg-red-100 text-red-700': plan.status === 'Rejected'
              }">{{ plan.status }}</span>
          </td>
          <td class="p-4 text-center space-x-3">
            <button class="text-blue-600 hover:text-blue-800 font-medium transition">Détails</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
