<div class="p-6 space-y-6">

  <!-- Chargement -->
  <div *ngIf="loading()" class="p-8 text-center text-gray-500">
    Chargement des sites...
  </div>

  <div *ngIf="!loading()">

    <!-- Barre de recherche, filtre et bouton Ajouter -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-wrap items-center gap-4 justify-between">

      <!-- Recherche et filtre -->
      <div class="flex flex-1 items-center gap-4 min-w-0">
        <!-- Input avec icône -->
        <div class="relative flex-1 min-w-0">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-gray-400">
              <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"/>
            </svg>
          </div>
          <input
            type="text"
            placeholder="Rechercher un site..."
            class="pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none w-full min-w-0"
            (input)="searchTerm.set($any($event.target).value)"
          />
        </div>

        <!-- Filtre -->
        <select
          class="px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 flex-shrink-0 text-gray-1000"
          (change)="selectedStatus.set($any($event.target).value)">
          <option value="">Tous statuts</option>
          <option>Actif</option>
          <option>Inactif</option>
        </select>
      </div>

      <!-- Bouton Ajouter un site -->
      <button
        (click)="goToAddSite()"
        class="px-4 py-2.5 bg-blue-900 text-white font-semibold rounded-xl shadow hover:bg-blue-800 transition flex items-center gap-2 flex-shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
          <path fill-rule="evenodd" d="M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd"/>
        </svg>
        Ajouter un site
      </button>
    </div>

    <!-- Tableau des sites -->
    <div class="bg-white shadow rounded-2xl overflow-x-auto mt-4">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nom</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Région</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pays</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Localisation</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let site of paginatedSites">
            <td class="px-6 py-4 whitespace-nowrap">{{ site.name }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ site.code }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ site.region }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ site.country }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ site.location }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                [ngClass]="{
                  'bg-green-200 text-green-800': site.is_active,
                  'bg-red-200 text-red-800': !site.is_active
                }"
                class="px-2 inline-flex text-xs font-semibold rounded-full"
              >
                {{ site.is_active ? 'Actif' : 'Inactif' }}
              </span>
            </td>
        <td class="px-6 py-4 whitespace-nowrap flex gap-2">

  <div class="relative group flex justify-center">

  <!-- Modifier site -->
  <button (click)="editSite(site.id)"
          class="px-3 py-1 text-blue-900 rounded hover:text-blue-800 flex items-center transition">
    
    <svg xmlns="http://www.w3.org/2000/svg"
         viewBox="0 0 24 24"
         fill="currentColor"
         class="w-6 h-6">
      <path d="M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"/>
    </svg>

  </button>

  <!-- Tooltip -->
  <span class="absolute bottom-full mb-2 hidden group-hover:block 
               bg-gray-500 text-white text-xs px-2 py-1 rounded shadow whitespace-nowrap">
    Modifier
  </span>

</div>
<div class="relative group flex justify-center">

  <!-- Gérer utilisateurs -->
  <a [routerLink]="['/sites', site.id, 'users']"
     class="px-3 py-1 text-blue-900 rounded hover:text-blue-800 transition flex items-center justify-center">
    
    <svg xmlns="http://www.w3.org/2000/svg"
         viewBox="0 0 24 24"
         fill="currentColor"
         class="w-6 h-6">
      <path fill-rule="evenodd"
            d="M15.75 1.5a6.75 6.75 0 0 0-6.651 7.906c.067.39-.032.717-.221.906l-6.5 6.499a3 3 0 0 0-.878 2.121v2.818c0 .414.336.75.75.75H6a.75.75 0 0 0 .75-.75v-1.5h1.5A.75.75 0 0 0 9 19.5V18h1.5a.75.75 0 0 0 .53-.22l2.658-2.658c.19-.189.517-.288.906-.22A6.75 6.75 0 1 0 15.75 1.5Zm0 3a.75.75 0 0 0 0 1.5A2.25 2.25 0 0 1 18 8.25a.75.75 0 0 0 1.5 0 3.75 3.75 0 0 0-3.75-3.75Z"
            clip-rule="evenodd"/>
    </svg>

  </a>

  <!-- Tooltip -->
  <span class="absolute bottom-full mb-2 hidden group-hover:block 
               bg-gray-500 text-white text-xs px-2 py-1 rounded shadow whitespace-nowrap">
    Gérer
  </span>

</div>


  <div *ngIf="isCorporate" class="relative group flex justify-center">

  <button (click)="toggleSiteStatus(site)"
          class="px-3 py-1 rounded flex items-center justify-center transition"
          [ngClass]="site.is_active ? 'text-green-600 hover:text-green-800' 
                                    : 'text-red-600 hover:text-red-800'">

    <ng-container *ngIf="site.is_active; else inactiveIcon">
      <!-- Icône Actif -->
      <svg xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 24 24"
           fill="currentColor"
           class="w-6 h-6">
        <path fill-rule="evenodd"
              d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"
              clip-rule="evenodd"/>
      </svg>
    </ng-container>

    <ng-template #inactiveIcon>
      <!-- Icône Inactif -->
      <svg xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 24 24"
           fill="currentColor"
           class="w-6 h-6">
        <path fill-rule="evenodd"
              d="m6.72 5.66 11.62 11.62A8.25 8.25 0 0 0 6.72 5.66Zm10.56 12.68L5.66 6.72a8.25 8.25 0 0 0 11.62 11.62ZM5.105 5.106c3.807-3.808 9.98-3.808 13.788 0 3.808 3.807 3.808 9.98 0 13.788-3.807 3.808-9.98 3.808-13.788 0-3.808-3.807-3.808-9.98 0-13.788Z"
              clip-rule="evenodd"/>
      </svg>
    </ng-template>

  </button>

  <!-- Tooltip dynamique -->
  <span class="absolute bottom-full mb-2 hidden group-hover:block 
               bg-gray-500 text-white text-xs px-2 py-1 rounded shadow whitespace-nowrap">
    {{ site.is_active ? 'Désactiver' : 'Activer' }}
  </span>

</div>

  
</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Message si aucun site -->
    <div *ngIf="sites().length === 0" class="p-8 text-center text-gray-500">
      Aucun site. Exécutez <code class="bg-gray-100 px-1">python init_db.py</code> pour ajouter des sites d'exemple.
    </div>

  </div>
</div>

<!-- Pagination -->
<div class="flex items-center justify-between px-4 py-3 bg-white border border-gray-200 rounded-xl shadow-sm mt-4">

  <!-- Info -->
  <p class="text-sm text-gray-500">
    Page <span class="font-semibold text-gray-700">{{ currentPage }}</span> sur
    <span class="font-semibold text-gray-700">{{ totalPages }}</span>
  </p>

  <!-- Boutons -->
  <div class="flex items-center gap-1">

    <!-- Précédent -->
    <button (click)="prevPage()" [disabled]="currentPage === 1"
      class="flex items-center gap-1.5 px-3 py-2 rounded-lg border border-gray-200 text-sm text-gray-600 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
      </svg>
      Précédent
    </button>

    <!-- Pages -->
    <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
      <button (click)="goToPage(i + 1)"
        class="w-9 h-9 rounded-lg border text-sm font-medium transition-all duration-200"
        [ngClass]="currentPage === i + 1
          ? 'bg-blue-900 border-blue-900 text-white shadow-md'
          : 'bg-white border-gray-200 text-gray-600 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300'">
        {{ i + 1 }}
      </button>
    </ng-container>

    <!-- Suivant -->
    <button (click)="nextPage()" [disabled]="currentPage === totalPages"
      class="flex items-center gap-1.5 px-3 py-2 rounded-lg border border-gray-200 text-sm text-gray-600 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300 disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-200">
      Suivant
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
      </svg>
    </button>

  </div>
</div>