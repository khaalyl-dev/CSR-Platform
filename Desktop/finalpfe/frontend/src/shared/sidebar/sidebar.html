<!-- Sidebar container -->
<!-- Uses flex column layout to stack Brand, Navigation, and User/Logout vertically -->
<div class="sidebar relative flex flex-col h-full bg-gray-800 text-white transition-all duration-300"
  [ngClass]="isCollapsed() ? 'w-16 collapsed' : 'w-64'">

  <!-- Top bar: Brand + Toggle button -->
  <div class="relative flex items-center justify-between p-4">

    <!-- Brand section -->
    <div class="flex items-center space-x-2">
      <!-- Logo / Icon for the brand -->
      <div class="logo-mark text-2xl"></div>

      <!-- Brand name -->
      <!-- Uses opacity + width/height to hide when sidebar is collapsed -->
      <div class="brand-name text-xl font-bold transition-opacity duration-300"
        [ngClass]="isCollapsed() ? 'opacity-0 w-0 h-0 overflow-hidden' : 'opacity-100'">
        CSR Platform
      </div>
    </div>

    <!-- Toggle button -->
    <!-- Clicking toggles sidebar collapsed state -->
    <button (click)="toggleSidebar()"
      class="flex h-6 w-6 items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 border-2 border-gray-800 transition-all duration-300">
      <!-- Arrow icon rotates when collapsed -->
      <svg class="h-4 w-4 transition-transform duration-300" [ngClass]="isCollapsed() ? 'rotate-180' : ''" fill="none"
        stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
  </div>

  <!-- Navigation menu -->
  <nav class="flex-1 overflow-y-auto px-2">
    <div *ngFor="let section of filteredNavItems(); trackBy: trackBySection" class="mb-4">

      <!-- Section title -->
      <!-- Hidden when sidebar is collapsed -->
      <div class="section uppercase text-gray-400 text-xs font-semibold mb-2 transition-opacity duration-300"
        [ngClass]="isCollapsed() ? 'opacity-0 h-0 overflow-hidden' : 'opacity-100'">
        {{ section.section }}
      </div>

      <ul>
        <li *ngFor="let item of section.items; trackBy: trackByItem">

          <!-- Navigation link -->
          <!-- Flex layout to align icon + label horizontally -->
          <!-- When collapsed: justify-center to center the icon -->
          <a [routerLink]="item.path" routerLinkActive="bg-gray-700"
            class="flex items-center transition-all duration-300 py-2 px-2 rounded hover:bg-gray-700"
            [ngClass]="isCollapsed() ? 'justify-center' : 'justify-start'">

            <!-- Icon container -->
            <!-- Flex center ensures icon is perfectly centered -->
            <span class="flex-shrink-0 w-6 h-6 flex justify-center text-gray-200">
              <fa-icon [icon]="item.icon" class="w-5 h-5"></fa-icon>
            </span>

            <!-- Label -->
            <!-- When collapsed: width=0 + opacity=0 hides label but keeps icon centered -->
            <span class="transition-all duration-300 whitespace-nowrap overflow-hidden"
              [ngClass]="isCollapsed() ? 'w-0 opacity-0 m-0 p-0' : 'ml-3 w-auto opacity-100'">
              {{ item.label }}
            </span>
          </a>

        </li>
      </ul>
    </div>
  </nav>

  <!-- User profile + Logout -->
  <div class="mt-auto p-4 border-t border-gray-700 flex flex-col space-y-2">

    <!-- User info -->
    <!-- Hidden when sidebar is collapsed -->
    <div *ngIf="user()" class="transition-opacity duration-300"
      [ngClass]="isCollapsed() ? 'opacity-0 h-0 overflow-hidden' : 'opacity-100'">
      <div class="text-white text-sm truncate">{{ user()?.email }}</div>
      <div class="text-gray-400 text-xs">{{ user()?.role }}</div>
    </div>

    <!-- Logout button -->
    <!-- Uses flex + justify-center + items-center to align content both collapsed & expanded -->
    <button class="btn-logout bg-white text-black font-semibold rounded hover:bg-gray-200
                   transition-all duration-300 flex items-center justify-center py-1 w-full" (click)="logout()">

      <!-- Expanded text -->
      <span *ngIf="!isCollapsed()" class="transition-all duration-300">
        Déconnexion
      </span>

      <!-- Collapsed icon -->
      <span *ngIf="isCollapsed()" class="transition-all duration-300 text-lg">
        ⇥
      </span>
    </button>

  </div>
</div>
